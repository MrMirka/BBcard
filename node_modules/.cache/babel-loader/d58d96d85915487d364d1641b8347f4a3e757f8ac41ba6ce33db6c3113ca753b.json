{"ast":null,"code":"/* eslint-disable */\nimport { AmbientLight, Group, PerspectiveCamera, PointLight, Scene, TextureLoader, WebGLRenderer } from 'three';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\nimport { gsap } from 'gsap';\nimport { Draggable } from 'gsap/Draggable';\nimport { InertiaPlugin } from './libs/InertiaPlugin';\nimport { CustomEase } from 'gsap/CustomEase';\nimport { generateStars } from './stars/Stars';\nimport modelSource from './models/model.glb';\nimport modelMapSource from './models/map.jpg';\nimport modelNormalMapSource from './models/normal.jpg';\nimport flashSource from './flash/flash.png';\nimport cardBackSource from './models/card.jpg';\nimport { getFlash } from './flash/flash';\nimport { getCard } from './card/card';\nimport { getModel } from './models/model';\ngsap.registerPlugin(Draggable, InertiaPlugin, CustomEase);\nexport const RESOLUTION = window.devicePixelRatio || 1;\nexport let CardInstanceState = /*#__PURE__*/function (CardInstanceState) {\n  CardInstanceState[CardInstanceState[\"not-loaded\"] = 0] = \"not-loaded\";\n  CardInstanceState[CardInstanceState[\"loaded\"] = 1] = \"loaded\";\n  CardInstanceState[CardInstanceState[\"start-animation-ended\"] = 2] = \"start-animation-ended\";\n  CardInstanceState[CardInstanceState[\"drag-ended\"] = 3] = \"drag-ended\";\n  CardInstanceState[CardInstanceState[\"end-animation-started\"] = 4] = \"end-animation-started\";\n  CardInstanceState[CardInstanceState[\"end-animation-ended\"] = 5] = \"end-animation-ended\";\n  return CardInstanceState;\n}({});\nexport class CardBoxInstance {\n  constructor(container, cover) {\n    this._state = 0;\n    this._isLoaded = false;\n    this._isComplete = false;\n    this._isDestroyed = false;\n    this._vw = 1;\n    this._vh = 1;\n    this._x = 1;\n    this._pos = {\n      x: 0,\n      y: 0\n    };\n    this._animation = {\n      // handPosX:\n    };\n    this._container = void 0;\n    this._hand = void 0;\n    this._onStateChange = () => {};\n    this._renderer = void 0;\n    this._scene = new Scene();\n    this._globalGroup = new Group();\n    this._camera = void 0;\n    this._model = void 0;\n    this._card = void 0;\n    this._flash = void 0;\n    this._stars = void 0;\n    // private readonly _clock = new Clock();\n    this._draggable = void 0;\n    this._onResize = () => this._resize();\n    this._tickHandler = () => this._tick();\n    // private readonly _onMove = (e: MouseEvent) => this._move(e);\n    this._raf = -1;\n    this._container = container;\n    this._renderer = new WebGLRenderer({\n      alpha: true,\n      antialias: true,\n      logarithmicDepthBuffer: true\n    });\n    this._container.appendChild(this._renderer.domElement);\n    this._hand = this._createHand();\n    this._renderer.setPixelRatio(RESOLUTION);\n    this._scene.add(this._globalGroup);\n    this._globalGroup.position.z = -10;\n    this._globalGroup.position.y = -0.03;\n    this._globalGroup.rotation.y = -Math.PI * 3;\n    this._camera = new PerspectiveCamera(60, 1, 0.01, 200000);\n    this._createLights();\n    this._draggable = this._createDrag(container);\n    this._resize();\n    // window.addEventListener('mousemove', this._onMove);\n    window.addEventListener('resize', this._onResize);\n    this._load(cover).then(() => {\n      if (this._isDestroyed) return;\n      this._resize();\n      this._raf = requestAnimationFrame(this._tickHandler);\n      this._changeState(1);\n    }).then(() => this._animateStart());\n  }\n  _changeState(state) {\n    this._state = state;\n    this._onStateChange(state);\n  }\n  _animateStart() {\n    const tl = gsap.timeline();\n    tl.to(this._globalGroup.position, {\n      z: -1,\n      y: -0.03,\n      duration: 2,\n      ease: 'power4.out'\n    }, 0.1);\n    tl.to(this._globalGroup.rotation, {\n      y: 0,\n      duration: 2.2,\n      ease: 'expo.out'\n    }, 0.1);\n    tl.to(this._hand.inner, {\n      x: 0,\n      y: 0,\n      opacity: 1,\n      ease: 'expo.out',\n      duration: 1\n    }, '-=1');\n    tl.add(() => {\n      this._draggable.enable();\n    }, 1.5);\n    tl.add(() => {\n      this._changeState(2);\n    });\n    tl.eventCallback(\"onComplete\", () => {\n      console.log(\"Анимация карты завершена\");\n    });\n  }\n  _animateDragEnd() {\n    var _top;\n    if (this._state >= 3) return;\n    this._draggable.disable();\n    (_top = this._model.top) === null || _top === void 0 ? void 0 : _top.removeFromParent();\n    this._changeState(3);\n    const tl = gsap.timeline();\n    tl.to(this._model.animation.position, {\n      y: -2,\n      x: 0.1,\n      duration: 1.5,\n      overwrite: true,\n      ease: 'power4.inOut'\n    }, 0);\n    tl.to(this._model.animation.rotation, {\n      z: Math.PI / 4,\n      duration: 2,\n      overwrite: true,\n      ease: 'expo.inOut'\n    }, 0);\n    tl.to(this._hand.inner, {\n      x: -5,\n      y: 50,\n      overwrite: true,\n      ease: 'power4.inOut',\n      duration: 1.3\n    }, 0);\n    tl.to(this._hand.inner, {\n      opacity: 0,\n      duration: 1,\n      overwrite: true,\n      ease: 'power4.inOut'\n    }, 0);\n\n    // tl.to(this._card!.rotation.rotation, {\n    //   z: Math.PI / 36,\n    //   duration: 1,\n    //   ease: 'power4.inOut'\n    // }, 0.2);\n    // tl.to(this._card!.rotation.rotation, {\n    //   y: 0,\n    //   duration: 1,\n    //   ease: 'power4.inOut'\n    // }, 0.3);\n\n    tl.to(this._card.rotation.rotation, {\n      z: 0,\n      y: 0,\n      duration: 1,\n      overwrite: true,\n      ease: 'power4.inOut'\n    }, 0.5);\n    tl.to(this._card.animation.scale, {\n      x: 1.4,\n      y: 1.4,\n      z: 1.4,\n      duration: 1,\n      overwrite: true,\n      ease: \"power4.inOut\"\n    }, 0.4);\n    tl.to(this._card.animation.position, {\n      y: 0.1,\n      duration: 1,\n      overwrite: true,\n      ease: \"power4.inOut\"\n    }, 0.4);\n\n    // flash\n    tl.to(this._flash.material, {\n      opacity: 1,\n      duration: 1,\n      ease: \"power4.inOut\"\n    }, 0);\n    tl.to(this._flash.mesh.position, {\n      y: 0.5,\n      duration: 1.2,\n      ease: \"power4.inOut\"\n    }, 0);\n    tl.to(this._flash.material, {\n      opacity: 0,\n      duration: 1,\n      ease: \"power4.inOut\"\n    }, 1.5);\n    tl.to(this._flash.mesh.position, {\n      y: -2,\n      duration: 1,\n      ease: \"power4.inOut\"\n    }, 1.5);\n\n    // stars\n    tl.to(this._stars.material.uniforms.u_position, {\n      value: 1.2,\n      duration: 3,\n      ease: CustomEase.create(\"custom\", \"M0,0 C0.116,0.42 0.074,0.778 0.18,0.89 0.273,0.988 0.818,1.001 1,1 \")\n    }, 0.5);\n    tl.to(this._stars.material.uniforms.u_opacity, {\n      value: 0.4,\n      duration: 0.5,\n      ease: 'power4.out'\n    }, 0.5);\n    tl.to(this._stars.material.uniforms.u_opacity, {\n      value: 0,\n      duration: 1,\n      ease: 'power4.in'\n    }, 1.2);\n    tl.to(this._card.animation.rotation, {\n      y: Math.PI * 2,\n      duration: 1,\n      overwrite: true,\n      ease: 'power4.out'\n    }, 2);\n    tl.to(this._card.animation.scale, {\n      x: 3,\n      y: 3,\n      z: 3,\n      duration: 1,\n      ease: 'power4.out',\n      onStart: () => this._changeState(4)\n    }, 3);\n    tl.to(this._container, {\n      opacity: 0,\n      duration: 1,\n      ease: 'power4.out'\n    }, 3);\n    tl.add(() => this._changeState(5));\n  }\n  destroy() {\n    this._isDestroyed = true;\n    this._draggable.kill();\n    this._container.removeChild(this._renderer.domElement);\n    this._container.removeChild(this._hand.el);\n    cancelAnimationFrame(this._raf);\n    // window.removeEventListener('mousemove', this._onMove);\n    window.removeEventListener('resize', this._onResize);\n  }\n  set onStateChange(func) {\n    this._onStateChange = func || (() => {});\n\n    // if (this._isLoaded && func) func();\n  }\n  _createHand() {\n    const el = document.createElement('div');\n    el.classList.add('card-box-hand');\n    const inner = document.createElement('div');\n    el.appendChild(inner);\n    inner.classList.add('card-box-hand-inner');\n    gsap.set(inner, {\n      y: 50,\n      x: 10,\n      opacity: 0\n    });\n    this._container.appendChild(el);\n    return {\n      el,\n      inner\n    };\n  }\n  _createDrag(container) {\n    const draggable = Draggable.create(document.createElement('div'), {\n      type: 'x',\n      trigger: container,\n      inertia: true,\n      edgeResistance: 0.8,\n      dragResistance: 0.5,\n      // velocity: 10000000,\n      resistance: 10000000,\n      snap: {\n        x: value => {\n          if (value < this._x * 0.2) {\n            return 0;\n          } else {\n            return this._x;\n          }\n        }\n      },\n      onDrag: () => this._onDrag(this._draggable.x),\n      onThrowUpdate: () => this._onDrag(this._draggable.x)\n    })[0];\n    draggable.disable();\n    return draggable;\n  }\n  _createLights() {\n    const ambient = new AmbientLight(0xFF7373, 0.3);\n    const point = new PointLight(0xD0FFFF, 2.5, 32, 1.2);\n    point.position.set(10, 5, 15);\n    const point2 = new PointLight(0xD0FFFF, 2, 13, 2);\n    point2.position.set(6, 0, 10);\n    this._scene.add(ambient, point, point2);\n    return {\n      ambient,\n      point\n    };\n  }\n  async _load(cover) {\n    const mLoader = new GLTFLoader();\n    const tLoader = new TextureLoader();\n    const [map, normalMap, model, flashMap, cardBackMap, cardFrontMap] = await Promise.all([tLoader.loadAsync(modelMapSource), tLoader.loadAsync(modelNormalMapSource), mLoader.loadAsync(modelSource), tLoader.loadAsync(flashSource), tLoader.loadAsync(cardBackSource), tLoader.loadAsync(cover)]);\n    if (this._isDestroyed) return;\n\n    // model\n    this._model = getModel(model, map, normalMap);\n\n    // flash\n    this._flash = getFlash(flashMap);\n\n    // stars\n    this._stars = generateStars();\n\n    // card\n    this._card = getCard(cardBackMap, cardFrontMap);\n    this._scene.add(this._flash.mesh, this._stars.group);\n    this._globalGroup.add(this._model.animation, this._card.animation);\n    this._isLoaded = true;\n  }\n  _resize() {\n    this._vw = window.innerWidth;\n    this._vh = window.innerHeight;\n    const heightCoeff = this._vh / 667;\n    this._container.style.width = this._vw + 'px';\n    this._container.style.height = this._vh + 'px';\n    this._renderer.setSize(this._vw, this._vh);\n    this._x = 261 * heightCoeff;\n    this._draggable.applyBounds({\n      minX: 0,\n      maxX: this._x\n    });\n    this._pos.y = -heightCoeff * 90;\n    this._pos.x = 118 * 2 * heightCoeff;\n    this._camera.aspect = this._vw / this._vh;\n    this._camera.updateProjectionMatrix();\n    this._updateHandPos(0);\n  }\n  _tick() {\n    this._renderer.render(this._scene, this._camera);\n\n    // if (this._mixer) {\n    //   this._mixer.update()\n    // }\n\n    this._raf = requestAnimationFrame(this._tickHandler);\n  }\n  _onDrag(x) {\n    if (this._state >= 3) return;\n    const {\n      clip,\n      mixer,\n      action,\n      rotation: modelRotation\n    } = this._model;\n    const {\n      rotation: cardRotation\n    } = this._card;\n    let coeff = x / this._x;\n    let coeffDur = coeff;\n    coeffDur = Math.min(coeffDur, 0.99);\n    coeffDur = Math.max(coeffDur, 0);\n    mixer.setTime(coeffDur * clip.duration);\n    modelRotation.rotation.y = coeffDur * (Math.PI / 12);\n    cardRotation.rotation.y = coeffDur * (Math.PI / 12);\n    let coeffPos = coeff * 2;\n    coeffPos = Math.min(coeffPos, 1);\n    this._updateHandPos(coeffPos);\n    if (coeffPos >= 0.99) {\n      this._animateDragEnd();\n    }\n  }\n  _updateHandPos(coeff) {\n    coeff = coeff - 0.5;\n    this._hand.el.style.transform = `translate3d(${this._pos.x * coeff}px, ${this._pos.y}px, 0) rotate(${coeff * 15}deg)`;\n  }\n\n  // private _move(e: MouseEvent)  {\n  //   const pos = (e.clientX - this._vw / 2) / this._vw;\n  //\n  //   this._globalGroup.rotation.y = Math.PI * pos * 2\n  // }\n}","map":{"version":3,"names":["AmbientLight","Group","PerspectiveCamera","PointLight","Scene","TextureLoader","WebGLRenderer","GLTFLoader","gsap","Draggable","InertiaPlugin","CustomEase","generateStars","modelSource","modelMapSource","modelNormalMapSource","flashSource","cardBackSource","getFlash","getCard","getModel","registerPlugin","RESOLUTION","window","devicePixelRatio","CardInstanceState","CardBoxInstance","constructor","container","cover","_state","_isLoaded","_isComplete","_isDestroyed","_vw","_vh","_x","_pos","x","y","_animation","_container","_hand","_onStateChange","_renderer","_scene","_globalGroup","_camera","_model","_card","_flash","_stars","_draggable","_onResize","_resize","_tickHandler","_tick","_raf","alpha","antialias","logarithmicDepthBuffer","appendChild","domElement","_createHand","setPixelRatio","add","position","z","rotation","Math","PI","_createLights","_createDrag","addEventListener","_load","then","requestAnimationFrame","_changeState","_animateStart","state","tl","timeline","to","duration","ease","inner","opacity","enable","eventCallback","console","log","_animateDragEnd","_top","disable","top","removeFromParent","animation","overwrite","scale","material","mesh","uniforms","u_position","value","create","u_opacity","onStart","destroy","kill","removeChild","el","cancelAnimationFrame","removeEventListener","onStateChange","func","document","createElement","classList","set","draggable","type","trigger","inertia","edgeResistance","dragResistance","resistance","snap","onDrag","_onDrag","onThrowUpdate","ambient","point","point2","mLoader","tLoader","map","normalMap","model","flashMap","cardBackMap","cardFrontMap","Promise","all","loadAsync","group","innerWidth","innerHeight","heightCoeff","style","width","height","setSize","applyBounds","minX","maxX","aspect","updateProjectionMatrix","_updateHandPos","render","clip","mixer","action","modelRotation","cardRotation","coeff","coeffDur","min","max","setTime","coeffPos","transform"],"sources":["/Users/fredgan/Documents/Projects/BetBoom/BBCard/src/CardBox/instance/CardBoxInstance.ts"],"sourcesContent":["/* eslint-disable */\nimport {\n  AmbientLight, AnimationAction, AnimationClip, AnimationMixer, BackSide,\n  Group, Mesh, MeshBasicMaterial, MeshPhongMaterial, MeshPhysicalMaterial,\n  PerspectiveCamera, PlaneGeometry, PointLight, Scene, Texture, TextureLoader,\n  Vector2, WebGLRenderer\n} from 'three';\nimport {GLTFLoader} from 'three/examples/jsm/loaders/GLTFLoader';\nimport {gsap} from 'gsap';\nimport {Draggable} from 'gsap/Draggable';\nimport {InertiaPlugin} from './libs/InertiaPlugin';\nimport {CustomEase} from 'gsap/CustomEase';\nimport {generateStars} from './stars/Stars';\nimport {RoundedCubeGeometry, RoundedPlaneGeometry} from './Rounded';\n\nimport modelSource from './models/model.glb';\nimport modelMapSource from './models/map.jpg';\nimport modelNormalMapSource from './models/normal.jpg';\nimport flashSource from './flash/flash.png';\nimport cardBackSource from './models/card.jpg';\nimport {getFlash} from './flash/flash';\nimport {getCard} from './card/card';\nimport {getModel} from './models/model';\n\ngsap.registerPlugin(Draggable, InertiaPlugin, CustomEase);\n\n\n\nexport const RESOLUTION = window.devicePixelRatio || 1;\n\nexport enum CardInstanceState {\n  'not-loaded',\n  'loaded',\n  'start-animation-ended',\n  'drag-ended',\n  'end-animation-started',\n  'end-animation-ended'\n}\nexport type EventHandler = (state: CardInstanceState) => void;\n\nexport class CardBoxInstance {\n  private _state = 0;\n\n  private _isLoaded = false;\n  private _isComplete = false;\n  private _isDestroyed = false;\n  private _vw = 1;\n  private _vh = 1;\n  private _x = 1;\n  private _pos = {\n    x: 0,\n    y: 0\n  }\n  private _animation = {\n    // handPosX:\n  }\n  private readonly _container: HTMLDivElement;\n  private readonly _hand: {\n    el: HTMLDivElement;\n    inner: HTMLDivElement;\n  };\n  private _onStateChange: EventHandler = () => {};\n\n  private readonly _renderer: WebGLRenderer;\n  private readonly _scene = new Scene();\n  private readonly _globalGroup = new Group();\n  private readonly _camera: PerspectiveCamera;\n  private _model?: ReturnType<typeof getModel>;\n  private _card?: ReturnType<typeof getCard>;\n  private _flash?: ReturnType<typeof getFlash>;\n  private _stars?: ReturnType<typeof generateStars>;\n  // private readonly _clock = new Clock();\n  private readonly _draggable: Draggable;\n\n  private readonly _onResize = () => this._resize();\n  private readonly _tickHandler = () => this._tick();\n  // private readonly _onMove = (e: MouseEvent) => this._move(e);\n\n  private _raf: ReturnType<typeof requestAnimationFrame> = -1;\n\n  constructor(container: HTMLDivElement, cover: string) {\n    this._container = container;\n\n    this._renderer = new WebGLRenderer({\n      alpha: true,\n      antialias: true,\n      logarithmicDepthBuffer: true\n    });\n    this._container.appendChild(this._renderer.domElement);\n    this._hand = this._createHand();\n    this._renderer.setPixelRatio(RESOLUTION);\n\n    this._scene.add(this._globalGroup);\n    this._globalGroup.position.z = -10;\n    this._globalGroup.position.y = -0.03;\n    this._globalGroup.rotation.y = -Math.PI * 3;\n\n    this._camera = new PerspectiveCamera(60, 1, 0.01, 200000);\n\n    this._createLights();\n\n    this._draggable = this._createDrag(container);\n\n    this._resize();\n    // window.addEventListener('mousemove', this._onMove);\n    window.addEventListener('resize', this._onResize);\n\n    this._load(cover)\n      .then(() => {\n        if (this._isDestroyed) return;\n\n        this._resize();\n        this._raf = requestAnimationFrame(this._tickHandler);\n        this._changeState(1);\n      })\n      .then(() => this._animateStart());\n  }\n\n  private _changeState(state: CardInstanceState) {\n    this._state = state;\n    this._onStateChange(state);\n  }\n\n\n  private _animateStart() {\n    const tl = gsap.timeline();\n\n    tl.to(this._globalGroup.position, {\n      z: -1,\n      y: -0.03,\n      duration: 2,\n      ease: 'power4.out'\n    }, 0.1);\n    tl.to(this._globalGroup.rotation, {\n      y: 0,\n      duration: 2.2,\n      ease: 'expo.out'\n    }, 0.1);\n\n    tl.to(this._hand.inner, {\n      x: 0,\n      y: 0,\n      opacity: 1,\n      ease: 'expo.out',\n      duration: 1\n    }, '-=1');\n\n    tl.add(() => {\n      this._draggable.enable();\n    }, 1.5);\n\n    tl.add(() => {\n      this._changeState(2)\n    })\n    tl.eventCallback(\"onComplete\", ()=>{\n      console.log(\"Анимация карты завершена\")\n    })\n  }\n  private _animateDragEnd() {\n    if (this._state >= 3) return;\n    this._draggable.disable();\n    this._model!.top?.removeFromParent();\n    this._changeState(3);\n\n    const tl = gsap.timeline();\n\n    tl.to(this._model!.animation.position, {\n      y: -2,\n      x: 0.1,\n      duration: 1.5,\n      overwrite: true,\n      ease: 'power4.inOut'\n    }, 0);\n    tl.to(this._model!.animation.rotation, {\n      z: Math.PI / 4,\n      duration: 2,\n      overwrite: true,\n      ease: 'expo.inOut'\n    }, 0);\n    tl.to(this._hand.inner, {\n      x: -5,\n      y: 50,\n      overwrite: true,\n      ease: 'power4.inOut',\n      duration: 1.3\n    }, 0);\n    tl.to(this._hand.inner, {\n      opacity: 0,\n      duration: 1,\n      overwrite: true,\n      ease: 'power4.inOut'\n    }, 0);\n\n    // tl.to(this._card!.rotation.rotation, {\n    //   z: Math.PI / 36,\n    //   duration: 1,\n    //   ease: 'power4.inOut'\n    // }, 0.2);\n    // tl.to(this._card!.rotation.rotation, {\n    //   y: 0,\n    //   duration: 1,\n    //   ease: 'power4.inOut'\n    // }, 0.3);\n\n\n    tl.to(this._card!.rotation.rotation, {\n      z: 0,\n      y: 0,\n      duration: 1,\n      overwrite: true,\n      ease: 'power4.inOut'\n    }, 0.5);\n    tl.to(this._card!.animation.scale, {\n      x: 1.4,\n      y: 1.4,\n      z: 1.4,\n      duration: 1,\n      overwrite: true,\n      ease: \"power4.inOut\"\n    }, 0.4);\n    tl.to(this._card!.animation.position, {\n      y: 0.1,\n      duration: 1,\n      overwrite: true,\n      ease: \"power4.inOut\"\n    }, 0.4);\n\n\n    // flash\n    tl.to(this._flash!.material, {\n      opacity: 1,\n      duration: 1,\n      ease: \"power4.inOut\"\n    }, 0);\n    tl.to(this._flash!.mesh.position, {\n      y: 0.5,\n      duration: 1.2,\n      ease: \"power4.inOut\"\n    }, 0);\n\n    tl.to(this._flash!.material, {\n      opacity: 0,\n      duration: 1,\n      ease: \"power4.inOut\"\n    }, 1.5);\n    tl.to(this._flash!.mesh.position, {\n      y: -2,\n      duration: 1,\n      ease: \"power4.inOut\"\n    }, 1.5);\n\n\n\n    // stars\n    tl.to(this._stars!.material.uniforms.u_position, {\n      value: 1.2,\n      duration: 3,\n      ease: CustomEase.create(\"custom\", \"M0,0 C0.116,0.42 0.074,0.778 0.18,0.89 0.273,0.988 0.818,1.001 1,1 \")\n    }, 0.5);\n\n    tl.to(this._stars!.material.uniforms.u_opacity, {\n      value: 0.4,\n      duration: 0.5,\n      ease: 'power4.out'\n    }, 0.5);\n    tl.to(this._stars!.material.uniforms.u_opacity, {\n      value: 0,\n      duration: 1,\n      ease: 'power4.in'\n    }, 1.2);\n\n\n    tl.to(this._card!.animation.rotation, {\n      y: Math.PI * 2,\n      duration: 1,\n      overwrite: true,\n      ease: 'power4.out'\n    }, 2);\n\n    tl.to(this._card!.animation.scale, {\n      x: 3,\n      y: 3,\n      z: 3,\n      duration: 1,\n      ease: 'power4.out',\n      onStart: () => this._changeState(4)\n    }, 3);\n    tl.to(this._container, {\n      opacity: 0,\n      duration: 1,\n      ease: 'power4.out',\n    }, 3)\n\n\n    tl.add(() => this._changeState(5));\n  }\n\n\n\n  public destroy() {\n    this._isDestroyed = true;\n    this._draggable.kill();\n\n    this._container.removeChild(this._renderer.domElement);\n    this._container.removeChild(this._hand.el);\n    cancelAnimationFrame(this._raf);\n    // window.removeEventListener('mousemove', this._onMove);\n    window.removeEventListener('resize', this._onResize);\n  }\n  public set onStateChange(func: EventHandler | undefined) {\n    this._onStateChange = func || (() => {});\n\n    // if (this._isLoaded && func) func();\n  }\n\n\n\n  private _createHand() {\n    const el = document.createElement('div');\n    el.classList.add('card-box-hand');\n    const inner = document.createElement('div');\n    el.appendChild(inner);\n    inner.classList.add('card-box-hand-inner');\n    gsap.set(inner, {\n      y: 50,\n      x: 10,\n      opacity: 0\n    })\n    this._container.appendChild(el);\n    return {\n      el, inner\n    };\n  }\n  private _createDrag(container: HTMLDivElement) {\n    const draggable =  Draggable.create(document.createElement('div'), {\n      type: 'x',\n      trigger: container,\n      inertia: true,\n      edgeResistance: 0.8,\n      dragResistance: 0.5,\n      // velocity: 10000000,\n      resistance: 10000000,\n      snap: {\n        x: (value) => {\n          if (value < this._x * 0.2) {\n            return 0;\n          } else {\n            return this._x;\n          }\n        }\n      },\n      onDrag: () => this._onDrag(this._draggable.x),\n      onThrowUpdate: () => this._onDrag(this._draggable.x)\n    })[0];\n\n    draggable.disable();\n\n    return draggable;\n  }\n  private _createLights() {\n    const ambient = new AmbientLight( 0xFF7373, 0.3);\n    const point = new PointLight( 0xD0FFFF, 2.5, 32 , 1.2);\n    point.position.set(10, 5, 15);\n    const point2 = new PointLight( 0xD0FFFF, 2, 13, 2);\n    point2.position.set(6, 0, 10);\n\n    this._scene.add(ambient, point, point2);\n\n    return {ambient, point};\n  }\n\n  private async _load(cover: string) {\n    const mLoader = new GLTFLoader();\n    const tLoader = new TextureLoader();\n\n    const [map, normalMap, model, flashMap, cardBackMap, cardFrontMap] = await Promise.all([\n      tLoader.loadAsync(modelMapSource),\n      tLoader.loadAsync(modelNormalMapSource),\n      mLoader.loadAsync(modelSource),\n      tLoader.loadAsync(flashSource),\n      tLoader.loadAsync(cardBackSource),\n      tLoader.loadAsync(cover)\n    ]);\n\n    if (this._isDestroyed) return;\n\n    // model\n    this._model = getModel(model, map, normalMap);\n\n    // flash\n    this._flash = getFlash(flashMap)\n\n    // stars\n    this._stars = generateStars();\n\n    // card\n    this._card = getCard(cardBackMap, cardFrontMap);\n\n    this._scene.add(this._flash.mesh, this._stars.group);\n    this._globalGroup.add(this._model.animation, this._card.animation);\n\n    this._isLoaded = true;\n  }\n  private _resize() {\n    this._vw = window.innerWidth;\n    this._vh = window.innerHeight;\n    const heightCoeff = this._vh / 667;\n\n    this._container.style.width = this._vw + 'px';\n    this._container.style.height = this._vh + 'px';\n\n    this._renderer.setSize(this._vw, this._vh);\n\n    this._x = 261 * heightCoeff;\n    this._draggable.applyBounds({\n      minX: 0,\n      maxX: this._x\n    });\n    this._pos.y = -heightCoeff * 90;\n    this._pos.x = 118 * 2 * heightCoeff;\n\n    this._camera.aspect = this._vw / this._vh;\n    this._camera.updateProjectionMatrix();\n\n    this._updateHandPos(0);\n  }\n  private _tick() {\n    this._renderer.render(this._scene, this._camera);\n\n    // if (this._mixer) {\n    //   this._mixer.update()\n    // }\n\n    this._raf = requestAnimationFrame(this._tickHandler);\n  }\n\n  private _onDrag(x: number) {\n    if (this._state >= 3) return;\n    const {clip, mixer, action, rotation: modelRotation} = this._model!;\n    const {rotation: cardRotation} = this._card!;\n\n    let coeff = x / this._x;\n    let coeffDur = coeff;\n    coeffDur = Math.min(coeffDur, 0.99);\n    coeffDur = Math.max(coeffDur, 0);\n\n    mixer.setTime(coeffDur * clip.duration);\n    modelRotation.rotation.y = coeffDur * (Math.PI / 12);\n    cardRotation.rotation.y = coeffDur * (Math.PI / 12);\n\n    let coeffPos = coeff * 2;\n    coeffPos = Math.min(coeffPos, 1);\n    this._updateHandPos(coeffPos);\n\n    if (coeffPos >= 0.99) {\n      this._animateDragEnd();\n    }\n  }\n  private _updateHandPos(coeff: number) {\n    coeff = coeff - 0.5;\n    this._hand.el.style.transform = `translate3d(${this._pos.x * coeff}px, ${this._pos.y}px, 0) rotate(${coeff * 15}deg)`;\n  }\n\n  // private _move(e: MouseEvent)  {\n  //   const pos = (e.clientX - this._vw / 2) / this._vw;\n  //\n  //   this._globalGroup.rotation.y = Math.PI * pos * 2\n  // }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}